# The Nest Protocol (v5.2)
> *Synthetic Civilization & Autonomous Governance System*

The Nest is a sovereign AI coding agent architecture that prioritizes **Governance over Speed**. Unlike standard coding copilots, The Nest employs a bicameral legislative system ("The Senate") to debate, test, and vote on every line of code before it is authorized.

## ğŸ› Architecture: The Senate Graph

The core logic is not a linear script, but a State Graph (`src/core/senate.py`):

1.  **Onyx (The Sentinel)**: Performs an **Intent Audit** (Fast LLM). Bans malicious usage (surveillance, destruction, hacking) before any code is generated.
2.  **Ignis (The Forge)**: Enters **The Crucible**. Instead of generating one solution, Ignis spawns three variants:
    *   **SPEED**: Optimized for performance.
    *   **SAFETY**: Optimized for error handling and defense.
    *   **CLARITY**: Optimized for readability.
3.  **Hydra (The Adversary)**: Runs **The Gauntlet**. Injects "venom" (metamorphic tests) into *all* candidates simultaneously to find failures.
4.  **Onyx (The Arbiter)**: Selects a **Champion** from the survivors based on test results and security profile.
5.  **Onyx (The Sentinel)**: Performs a final **Code Audit** on the Champion's binary signature.

## ğŸ§  The Synapse (Brain) & Omega-Tier Routing

The system is powered by a **Granular Model Routing** engine (`src/core/brain.py`), allowing specific cognitive specializations:

*   **Ignis (Synthesis)**: Targets `claude-opus-4.5` for complex code generation.
*   **Hydra (Context)**: Targets `gemini-3-pro` for massive-context red teaming.
*   **Onyx (Reasoning)**: Targets `gpt-5.2` for logic, ethics, and governance.

*Note: The system supports the **Gateway Pattern** (OpenRouter/Gateway) via `OPENAI_BASE_URL`.*

## âš¡ï¸ Interface & API

The Nest exposes a **FastAPI** layer (`src/api.py`) for external integration:

-   **HTTP REST**: `POST /missions` for synchronous execution.
-   **WebSockets**: `ws://localhost:8000/ws/senate` for real-time streaming of the deliberation process.
-   **Chronicle**: `GET /chronicle/search` to query Stare Decisis (Case Law).

## ğŸš€ Getting Started

### 1. Prerequisites
-   Python 3.9+
-   OpenAI API Key (or OpenRouter/Gateway Key)

### 2. Installation
#### Option A: Docker (Recommended)
The entire system (API, Oracle, Redis) can be launched with a single command.

```bash
docker-compose up --build
```

- API: http://localhost:8000
- WebSocket: ws://localhost:8000/ws/senate
- Redis: localhost:6379

#### Option B: Manual
```bash
pip install -r requirements.txt
# Ensure Redis is running separately
```

### 3. Configuration
Create a `.env` file (Gateway Pattern Example):
```bash
# Gateway Configuration
OPENAI_BASE_URL=https://openrouter.ai/api/v1
OPENAI_API_KEY=sk-or-your-key

# Default Brain
NEST_MODEL_DEEP=openai/gpt-5-turbo
NEST_MODEL_FAST=openai/gpt-4o

# Granular Routing (Omega Models)
IGNIS_MODEL=anthropic/claude-opus-4.5
HYDRA_MODEL=google/gemini-3-pro
ONYX_MODEL=openai/gpt-5.2
```

### 4. Ignite the Server
```bash
python3 -m uvicorn src.api:app --reload --port 8000
```

### 5. Run the Test Suite
```bash
python3 -m pytest tests/
```

## ğŸ“‚ Project Structure

```
src/
â”œâ”€â”€ api.py              # FastAPI & WebSocket Interface
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ elder.py        # The Kernel / Workflow Orchestrator
â”‚   â”œâ”€â”€ senate.py       # The State Graph (Nodes & Edges)
â”‚   â”œâ”€â”€ dragons.py      # The Agents (Ignis, Hydra, Onyx)
â”‚   â”œâ”€â”€ brain.py        # LLM Adapter / Synapse
â”‚   â””â”€â”€ types.py        # TypedDicts & States
â”œâ”€â”€ memory/
â”‚   â””â”€â”€ chronicle.py    # Long-term Memory (JSON/Vector)
â””â”€â”€ security/
    â””â”€â”€ signer.py       # Cryptographic Signatures
tests/                  # Comprehensive Pytest Suite
```

## ğŸ“œ Governance Status
-   **Sprint**: 12 (The Crucible)
-   **Status**: Operational / Sovereign
-   **Protocol Version**: 5.2

---
*Generated by Gemini 3 Pro (Preview)*