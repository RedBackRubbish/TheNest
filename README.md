# The Nest Protocol (v5.2)
> *Synthetic Civilization & Autonomous Governance System*

The Nest is a sovereign AI coding agent architecture that prioritizes **Governance over Speed**. Unlike standard coding copilots, The Nest employs a bicameral legislative system ("The Senate") to debate, test, and vote on every line of code before it is authorized.

## ğŸ› Architecture: The Senate Graph

The core logic is not a linear script, but a State Graph (`src/core/senate.py`):

1.  **Onyx (The Sentinel)**: Performs an **Intent Audit** (Fast LLM). Bans malicious usage (surveillance, destruction, hacking) before any code is generated.
2.  **Ignis (The Forge)**: Synthesizes high-performance Python code compliant with the **Rosetta Constraint** (Code + Explanation + Signature).
3.  **Hydra (The Adversary)**: Injects "venom" (metamorphic tests) into the code to find edge cases and privacy leaks.
4.  **Onyx (The Sentinel)**: Performs a final **Code Audit** (Deep LLM) on the binary signature.

## ğŸ§  The Synapse (Brain)

The system is powered by a Bi-Cameral Inference Engine (`src/core/brain.py`):
-   **Deep Mode (`gpt-5.2`)**: Used for coding (Ignis) and security audits (Onyx).
-   **Fast Mode (`gpt-4o`)**: Used for rapid intent checks and routing.
-   **Lobotomized Mode**: Gracefully degrades to internal mock logic if no API Keys are present.

## âš¡ï¸ Interface & API

The Nest exposes a **FastAPI** layer (`src/api.py`) for external integration:

-   **HTTP REST**: `POST /missions` for synchronous execution.
-   **WebSockets**: `ws://localhost:8000/ws/senate` for real-time streaming of the deliberation process.
-   **Chronicle**: `GET /chronicle/search` to query Stare Decisis (Case Law).

## ğŸš€ Getting Started

### 1. Prerequisites
-   Python 3.9+
-   OpenAI API Key (Optional, system mocks without it)

### 2. Installation
#### Option A: Docker (Recommended)
The entire system (API, Oracle, Redis) can be launched with a single command.

```bash
docker-compose up --build
```

- API: http://localhost:8000
- WebSocket: ws://localhost:8000/ws/senate
- Redis: localhost:6379

#### Option B: Manual
```bash
pip install -r requirements.txt
# Ensure Redis is running separately
```

### 3. Configuration
Create a `.env` file:
```bash
OPENAI_API_KEY=sk-...
NEST_MODEL_DEEP=gpt-5.2
NEST_MODEL_FAST=gpt-4o
```

### 4. Ignite the Server
```bash
python3 -m uvicorn src.api:app --reload --port 8000
```

### 5. Submit a Mission (CLI Example)
```bash
# Test the WebSocket Interface
python3 tests/test_ws_client.py "Write a fibonacci server"
```

## ğŸ“‚ Project Structure

```
src/
â”œâ”€â”€ api.py              # FastAPI & WebSocket Interface
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ elder.py        # The Kernel / Workflow Orchestrator
â”‚   â”œâ”€â”€ senate.py       # The State Graph (Nodes & Edges)
â”‚   â”œâ”€â”€ dragons.py      # The Agents (Ignis, Hydra, Onyx)
â”‚   â”œâ”€â”€ brain.py        # LLM Adapter / Synapse
â”‚   â””â”€â”€ types.py        # TypedDicts & States
â”œâ”€â”€ memory/
â”‚   â””â”€â”€ chronicle.py    # Long-term Memory (JSON/Vector)
â””â”€â”€ security/
    â””â”€â”€ signer.py       # Cryptographic Signatures
```

## ğŸ“œ Governance Status
-   **Sprint**: 9 (The Nervous System)
-   **Status**: Operational / Sovereign
-   **Protocol Version**: 5.2

---
*Generated by Gemini 3 Pro (Preview)*